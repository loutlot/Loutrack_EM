# M0 PoC 配線接続表

## 使用機材

| 部品 | 型番 | 入手先 | データシート |
|------|------|--------|--------------|
| MCU | XIAO ESP32C3 | [AliExpress](https://ja.aliexpress.com/item/1005006114576182.html) | [Wiki](https://wiki.seeedstudio.com/XIAO_ESP32C3_Getting_Started/) |
| 3軸コイル | 3D11-722J | [AliExpress](https://ja.aliexpress.com/item/1005004723068527.html) | [PDF](https://ru.shinhom.com/Content/upload/pdf/202339189/3D11-Series.pdf) |
| モータドライバ | DRV8835モジュール (AE-DRV8835-S) | 秋月電子 (109848) | [PDF](https://akizukidenshi.com/goodsaffix/AE-DRV8835-S_20210526.pdf) |
| オペアンプ | MCP6022-I/P | 秋月電子 (116187) | |
| ADC | MCP3008-I/P | 秋月電子 (109485) | |

---

## XIAO ESP32C3 ピンアウト

```
        ┌─────────────────┐
        │   XIAO ESP32C3  │
        │                 │
   D0 ──┤ GPIO2    5V    ├── 5V出力
   D1 ──┤ GPIO3    GND   ├── GND
   D2 ──┤ GPIO4    3V3   ├── 3.3V出力
   D3 ──┤ GPIO5    GPIO10├── D10 (MOSI)
   D4 ──┤ GPIO6    GPIO9 ├── D9  (MISO)
   D5 ──┤ GPIO7    GPIO8 ├── D8  (SCK)
   D6 ──┤ GPIO21   GPIO20├── D7  (RX/CS)
        └─────────────────┘

左側: D0-D6 (GPIO2,3,4,5,6,7,21)
右側: 5V, GND, 3V3, D10-D7 (GPIO10,9,8,20)
```

---

## DRV8835モジュール (AE-DRV8835-S) ピンアウト

[データシート](https://akizukidenshi.com/goodsaffix/AE-DRV8835-S_20210526.pdf)より:

```
ピン番号は基板左上を起点に反時計回り

        ┌────────────────┐
   VM ─1┤●            ●├12─ VCC
AOUT1 ─2┤●            ●├11─ MODE
AOUT2 ─3┤●            ●├10─ AIN1
BOUT1 ─4┤●            ●├9── AIN2
BOUT2 ─5┤●            ●├8── BIN1
  GND ─6┤●            ●├7── BIN2
        └────────────────┘
```

| ピン | 名称 | 機能 |
|------|------|------|
| 1 | VM | モータ電源 (0〜11V) |
| 2 | AOUT1 | A出力1 |
| 3 | AOUT2 | A出力2 |
| 4 | BOUT1 | B出力1 |
| 5 | BOUT2 | B出力2 |
| 6 | GND | グランド |
| 7 | BIN2 | B入力2 |
| 8 | BIN1 | B入力1 |
| 9 | AIN2 | A入力2 |
| 10 | AIN1 | A入力1 |
| 11 | MODE | モード設定 (0=IN/IN, 1=PHASE/ENABLE) |
| 12 | VCC | ロジック電源 (2〜7V) |

### IN/INモード (MODE = 0 = GND接続)

| xIN1 | xIN2 | xOUT1 | xOUT2 | 動作 |
|------|------|-------|-------|------|
| 0 | 0 | HiZ | HiZ | 空転 |
| 0 | 1 | L | H | 逆転 |
| 1 | 0 | H | L | 正転 |
| 1 | 1 | L | L | ブレーキ |

---

## 3D11-722J コイル スペック

[データシート](https://ru.shinhom.com/Content/upload/pdf/202339189/3D11-Series.pdf)より:

| 項目 | 値 |
|------|-----|
| サイズ | 11.8 × 11.8 × 2.9 mm |
| インダクタンス (L) | 7.20 mH（各軸） |
| Q値 | 30 |
| 自己共振周波数 (SRF) | 330 kHz (X,Y), 700 kHz (Z) |
| DC抵抗 | 150Ω (X,Y), 210Ω (Z) |

---

## 電源系統

| 信号名 | 電圧 | 接続元 | 接続先 | 備考 |
|--------|------|--------|--------|------|
| 5V | 5V | XIAO 5V | DRV8835 VM (ピン1) | 送信電源 |
| 3.3V | 3.3V | XIAO 3V3 | MCP6022 VDD, MCP3008 VDD, Vmid分圧 | アナログ電源 |
| GND | 0V | XIAO GND | 全モジュール | 一点接続推奨 |

---

## Beacon（送信）接続

### XIAO ESP32C3 → DRV8835

| 信号名 | XIAO ピン | GPIO | DRV8835ピン | 備考 |
|--------|-----------|------|-------------|------|
| PWM_X | D0 | GPIO2 | ピン10 (AIN1) | 20kHz PWM |
| PWM_X_INV | D1 | GPIO3 | ピン9 (AIN2) | 反転PWM（または GND固定） |
| - | - | - | ピン11 (MODE) | GNDへ接続（IN/INモード） |

### DRV8835 電源

| ピン | 接続先 | 備考 |
|------|--------|------|
| ピン1 (VM) | 5V | モータ電源 |
| ピン12 (VCC) | 3.3V | ロジック電源 |
| ピン6 (GND) | GND | |
| ピン11 (MODE) | GND | IN/INモード |

### DRV8835 → 送信コイル（3D11-722J #1）

| DRV8835ピン | 接続先 | 備考 |
|-------------|--------|------|
| ピン2 (AOUT1) | 3D11-722J X軸端子1 | コイル端子A |
| ピン3 (AOUT2) | 3D11-722J X軸端子2 | コイル端子B |

### 共振C

| 部品 | 接続 | 備考 |
|------|------|------|
| 8760pF (8200+560) | AOUT1-AOUT2間に並列 | 初期値、要調整 |

### DRV8835 デカップリング

| 部品 | 接続 | 備考 |
|------|------|------|
| 0.1µF | VM(ピン1)-GND | IC近傍 |
| 100µF電解 | 5V-GND | バルク |

---

## Tracker（受信）接続

### Vmid生成

| 部品/信号 | 接続 | 備考 |
|-----------|------|------|
| 10kΩ #1 | 3.3V → Vmid_raw | 分圧上側 |
| 10kΩ #2 | Vmid_raw → GND | 分圧下側 |
| 0.1µF | Vmid_raw → GND | 平滑 |
| MCP6022 ch1 (+) | Vmid_raw | 電圧フォロワ入力 |
| MCP6022 ch1 (-) | Vmid_out | フィードバック |
| MCP6022 ch1 out | Vmid_out | バッファ後の安定Vmid |

### 受信コイル（3D11-722J #2）→ MCP6022

| コイル端子 | 接続先 | 備考 |
|------------|--------|------|
| X軸端子1 | Vmid_out | コイル基準 |
| X軸端子2 | MCP6022 ch2 (+IN B) | 信号入力 |

### 受信アンプ（MCP6022 ch2）

| 部品/信号 | 接続 | 備考 |
|-----------|------|------|
| 10kΩ (Rf) | MCP6022 ch2 out → (-IN B) | フィードバック抵抗 |
| 1kΩ (Rg) | MCP6022 ch2 (-IN B) → Vmid_out | ゲイン設定抵抗 |
| 47pF | Rfに並列 | 発振防止 |
| MCP6022 ch2 out | ADC入力へ | 増幅後信号 |

### MCP6022 電源

| ピン | 接続 | 備考 |
|------|------|------|
| VDD (ピン8) | 3.3V | |
| VSS (ピン4) | GND | |
| 0.1µF | VDD-GND | IC近傍 |

### 入力保護（BAT43）

| 部品 | 接続 | 備考 |
|------|------|------|
| BAT43 #1 | ADC入力 → 3.3V (カソード→アノード) | 上側クランプ |
| BAT43 #2 | GND → ADC入力 (カソード→アノード) | 下側クランプ |

### MCP3008 ADC → XIAO ESP32C3

| MCP3008ピン | 接続先 | XIAO | 備考 |
|-------------|--------|------|------|
| VDD (ピン16) | 3.3V | - | |
| VREF (ピン15) | 3.3V | - | |
| AGND (ピン14) | GND | - | |
| DGND (ピン9) | GND | - | |
| CLK (ピン13) | D8 | GPIO8 | SPI CLK |
| DOUT (ピン12) | D9 | GPIO9 | SPI MISO |
| DIN (ピン11) | D10 | GPIO10 | SPI MOSI |
| CS (ピン10) | D7 | GPIO20 | SPI CS |
| CH0 (ピン1) | アンプ出力 | - | 受信信号 |
| CH1-CH7 | 未接続 | - | 将来3軸用 |

### MCP3008 デカップリング

| 部品 | 接続 | 備考 |
|------|------|------|
| 0.1µF | VDD-DGND | IC近傍 |
| 0.1µF | VREF-AGND | IC近傍 |

---

## ブレッドボード配置ガイド

```
【推奨配置】

┌──────────────────────────────────────────────────────────────────┐
│                        ブレッドボード EIC-106J                   │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [送信エリア]              [   間隔   ]       [受信エリア]       │
│                                                                  │
│  ┌─────────┐                              ┌─────────────────┐   │
│  │DRV8835  │                              │MCP6022          │   │
│  │(109848) │           5cm以上            │(Vmid+アンプ)    │   │
│  │         │           離す               │                 │   │
│  │3D11-722J│                              │MCP3008          │   │
│  │ #1(送信)│                              │(ADC)            │   │
│  │ + 共振C │                              │                 │   │
│  └─────────┘                              │BAT43 (保護)     │   │
│                                            │                 │   │
│                                            │3D11-722J        │   │
│                                            │ #2(受信)        │   │
│                                            └─────────────────┘   │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                    XIAO ESP32C3                              ││
│  │  (中央付近に配置、両側へアクセスしやすく)                    ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
└──────────────────────────────────────────────────────────────────┘

【GND接続】
- 受信側でGNDを合流させる（一点接続）
- 送信側のGNDは細いジャンパで受信側GNDへ
```

---

## 配線チェックリスト

### 電源投入前の確認

- [ ] 3.3VとGNDがショートしていないこと（テスタで確認）
- [ ] 5VとGNDがショートしていないこと
- [ ] DRV8835のVM (ピン1) が5Vに接続されていること
- [ ] DRV8835のVCC (ピン12) が3.3Vに接続されていること
- [ ] DRV8835のMODE (ピン11) がGNDに接続されていること
- [ ] MCP6022, MCP3008のVDDが3.3Vに接続されていること
- [ ] 全てのGNDが接続されていること
- [ ] ICの向きが正しいこと（ピン1マーク確認）

### 電源投入後の確認

- [ ] XIAO ESP32C3が正常起動すること（LED点灯）
- [ ] DRV8835が過熱していないこと（触って確認）
- [ ] MCP6022 Vmid出力が約1.65Vであること
- [ ] MCP3008がSPIで応答すること
