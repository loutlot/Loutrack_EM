# M2 SMD基板 部品リスト（BOM）

## 概要

3軸SMD試作基板用の部品リスト（Tracker側）

**M2の特徴**:
- SMD直付け実装（devボードではなくIC直接実装）
- LIS3DH (LGA-16) + 周辺部品
- バッテリー駆動対応

---

## LIS3DH（3軸加速度センサー）— SMD実装

### IC

| 入手先 | 型番 | パッケージ | 価格 | 数量 | 備考 |
|--------|------|----------|------|------|------|
| DigiKey | LIS3DHTR | LGA-16 (3x3x1mm) | 約$1.5 | 1 | |
| LCSC | LIS3DHTR | LGA-16 (3x3x1mm) | 約$0.8 | 1 | 中国発送 |
| AliExpress | LIS3DHTR | LGA-16 (3x3x1mm) | 約$0.5-1 | 1 | 安価だが品質要確認 |

**データシート**: [`documents/requirements/lis3dh/lis3dh.pdf`](../../requirements/lis3dh/lis3dh.pdf)

### LIS3DH周辺部品

| 部品 | 値 | パッケージ | 数量 | 接続先 | 用途 | 備考 |
|------|-----|----------|------|--------|------|------|
| C1 | 100nF | 0402/0603 | 1 | VDD-GND | デカップリング | 必須 |
| C2 | 10µF | 0603/0805 | 1 | VDD-GND | バルクデカップリング | 推奨 |
| C3 | 100nF | 0402/0603 | 1 | VDD_IO-GND | IO電源デカップリング | VDD共用可 |
| R1 | 4.7kΩ | 0402/0603 | 1 | SDA-3.3V | I2Cプルアップ | |
| R2 | 4.7kΩ | 0402/0603 | 1 | SCL-3.3V | I2Cプルアップ | |

### LIS3DH接続

| LIS3DHピン | 接続先 | 備考 |
|------------|--------|------|
| VDD | 3.3V | 電源 |
| VDD_IO | 3.3V | IO電源（VDD共用可） |
| GND | GND | |
| SDA | GPIO6 (D4) + 4.7kΩプルアップ | I2Cデータ |
| SCL | GPIO7 (D5) + 4.7kΩプルアップ | I2Cクロック |
| SA0 | GND | I2Cアドレス=0x18 |
| CS | VDD | I2Cモード選択（SPIモードでは未使用） |
| INT1 | NC | 将来拡張用（割り込み） |
| INT2 | NC | 将来拡張用（割り込み） |

---

## バッテリー監視回路

**参考**: [`documents/outside_sources/Xiao_ESP32C3_battery/lipo_overdischarge_protection.md`](../../outside_sources/Xiao_ESP32C3_battery/lipo_overdischarge_protection.md)

### 分圧回路部品

| 部品 | 値 | パッケージ | 数量 | 用途 | 備考 |
|------|-----|----------|------|------|------|
| R3 | 1MΩ | 0402/0603 | 1 | 分圧上側 | 漏電電流削減のため1MΩ推奨 |
| R4 | 1MΩ | 0402/0603 | 1 | 分圧下側 | |
| C4 | 100nF | 0402/0603 | 1 | ADC入力安定化 | オプション |

### 接続

| 信号 | 接続先 | 備考 |
|------|--------|------|
| LiPo+ | R3 (1MΩ) → ADC入力 (D0/GPIO2) | 分圧後 |
| ADC入力 | R4 (1MΩ) → GND | |
| 分圧比 | 0.5 | V_adc = V_battery × 0.5 |

---

## MCU周辺部品

### XIAO ESP32C3用

| 部品 | 値 | パッケージ | 数量 | 用途 | 備考 |
|------|-----|----------|------|------|------|
| C5 | 100nF | 0402/0603 | 1 | 3.3V デカップリング | |
| C6 | 10µF | 0603/0805 | 1 | 3.3V バルク | |

---

## ADC (MCP3008) 周辺部品

| 部品 | 値 | パッケージ | 数量 | 用途 | 備考 |
|------|-----|----------|------|------|------|
| C7 | 100nF | 0402/0603 | 1 | VDD-DGND | デカップリング |
| C8 | 100nF | 0402/0603 | 1 | VREF-AGND | リファレンス安定化 |

---

## アナログフロントエンド (MCP6022) 周辺部品

### 各軸アンプ（X/Y/Z × 3セット）

| 部品 | 値 | パッケージ | 数量 | 用途 | 備考 |
|------|-----|----------|------|------|------|
| Rf | 10kΩ | 0402/0603 | 3 | フィードバック抵抗 | ゲイン設定 |
| Rg | 1kΩ | 0402/0603 | 3 | ゲイン設定抵抗 | |
| Cf | 47pF | 0402/0603 | 3 | 発振防止 | Rfに並列 |

### Vmid生成

| 部品 | 値 | パッケージ | 数量 | 用途 | 備考 |
|------|-----|----------|------|------|------|
| R_vmid1 | 10kΩ | 0402/0603 | 1 | 分圧上側 | 3.3V → Vmid |
| R_vmid2 | 10kΩ | 0402/0603 | 1 | 分圧下側 | Vmid → GND |
| C_vmid | 100nF | 0402/0603 | 1 | Vmid平滑 | |

---

## M2 GPIO割り当て（Tracker側）

| 機能 | ピン | GPIO | ADC | 備考 |
|------|------|------|-----|------|
| バッテリー監視 | D0 | GPIO2 | ✅ ADC1 | 分圧回路経由 |
| Wake-upボタン | D1 | GPIO3 | ✅ ADC1 | Deep Sleep復帰 |
| 空き | D2 | GPIO4 | ✅ ADC1 | |
| 空き | D3 | GPIO5 | ❌ | |
| I2C_SDA (LIS3DH) | D4 | GPIO6 | ❌ | |
| I2C_SCL (LIS3DH) | D5 | GPIO7 | ❌ | |
| 空き | D6 | GPIO21 | ❌ | |
| SPI_CS (MCP3008) | D7 | GPIO20 | ❌ | |
| SPI_SCK (MCP3008) | D8 | GPIO8 | ❌ | |
| SPI_MISO (MCP3008) | D9 | GPIO9 | ❌ | |
| SPI_MOSI (MCP3008) | D10 | GPIO10 | ❌ | |

**使用ピン数**: 8（SPI 4 + I2C 2 + バッテリー監視 1 + Wake-up 1）
**空きピン数**: 3（D2, D3, D6）

---

## 部品サマリー

### SMD部品一覧

| カテゴリ | 部品 | 値 | パッケージ | 数量 |
|----------|------|-----|----------|------|
| IC | LIS3DHTR | - | LGA-16 | 1 |
| コンデンサ | デカップリング | 100nF | 0402/0603 | 6 |
| コンデンサ | バルク | 10µF | 0603/0805 | 2 |
| 抵抗 | I2Cプルアップ | 4.7kΩ | 0402/0603 | 2 |
| 抵抗 | バッテリー分圧 | 1MΩ | 0402/0603 | 2 |
| 抵抗 | ゲイン設定 (Rf) | 10kΩ | 0402/0603 | 4 |
| 抵抗 | ゲイン設定 (Rg) | 1kΩ | 0402/0603 | 3 |
| コンデンサ | 発振防止 | 47pF | 0402/0603 | 3 |

### 実装上の注意

1. **LIS3DH (LGA-16)**: 3x3mmの微小パッケージ、リフローはんだ付け推奨
2. **パッド設計**: データシートのフットプリント推奨値に従う
3. **配線**: I2Cラインは短く、GNDプレーンから離す
4. **デカップリング**: ICの近傍に配置

---

## 参考資料

- [LIS3DHデータシート](../../requirements/lis3dh/lis3dh.pdf)
- [XIAO ESP32C3 バッテリー駆動設定](../../outside_sources/Xiao_ESP32C3_battery/lipo_overdischarge_protection.md)
- [M2電源回路図](../../schematics/m2_smd/tracker/power_schematic.md)
