# モジュール2: 受信アンプ（MCP6022）

## 概要

このモジュールでは:
1. MCP6022をブレッドボードに配置
2. 1ch目をVmidバッファとして構成
3. 2ch目を受信信号の増幅回路として構成

---

## MCP6022について

MCP6022は**2チャンネル入りのオペアンプ**です。

### ピン配置（DIP-8）

```
        ┌───∪───┐
 OUT A ─┤1    8├─ VDD (3.3V)
  -IN A ─┤2    7├─ OUT B
  +IN A ─┤3    6├─ -IN B
    VSS ─┤4    5├─ +IN B
        └───────┘

A = 1ch目（Vmidバッファに使用）
B = 2ch目（受信アンプに使用）
```

⚠️ **ICの向き確認:** ピン1の位置を示すマーク（くぼみ、点）を確認してから挿入！

---

## 必要な部品

| 部品 | 秋月コード | 数量 | 用途 |
|------|------------|------|------|
| MCP6022-I/P | 116187 | 1 | オペアンプIC |
| 抵抗 10kΩ 0.1% | 116877 | 1 | Rf（フィードバック抵抗） |
| 抵抗 1kΩ 0.1% | 116876 | 1 | Rg（ゲイン設定抵抗） |
| コンデンサ 47pF | 108045 | 1 | 発振防止 |
| コンデンサ 0.1µF | 117059 | 1 | 電源デカップリング |

---

## 手順

### Step 1: MCP6022の配置

ブレッドボードの中央の溝をまたぐようにICを挿入します。

```
     列: 20 21 22 23 24
        ┌──┴──┴──┴──┴──┐
        │              │
   ● ● │●  ●  ●  ●  │ ● ●   ← 行A（ピン1-4側）
        │      溝      │
   ● ● │●  ●  ●  ●  │ ● ●   ← 行E/F（ピン5-8側）
        │              │
        └──────────────┘

ピン1(OUTA)は列20行A、ピン8(VDD)は列20行F、など
```

### Step 2: 電源接続

| ピン | 接続先 | 配線 |
|------|--------|------|
| ピン8 (VDD) | 3.3Vレール | ジャンパワイヤ |
| ピン4 (VSS) | GNDレール | ジャンパワイヤ |

### Step 3: デカップリングコンデンサ

VDDとVSSの近く（ICのすぐ横）に0.1µFを追加:

1. ピン8と同じ列に0.1µFの片足
2. もう片足をGNDレールに

💡 **なぜICの近くに置く？** 遠いとノイズ除去効果が薄れます。

### Step 4: Vmidバッファ（1ch目）の配線

**電圧フォロワ回路:**

```
Vmid_raw ──[+IN A]
              │
           [MCP6022 A]
              │
[OUT A]───┬───[-IN A]
          │
          └── Vmid_out（バッファ後）
```

**配線:**

| 接続元 | 接続先 | 説明 |
|--------|--------|------|
| Vmid_raw（モジュール1で作った） | ピン3 (+IN A) | 入力 |
| ピン1 (OUT A) | ピン2 (-IN A) | フィードバック |
| ピン1 (OUT A) | Vmid_outとして使用 | 出力 |

**確認:** テスターでピン1（OUT A）とGND間を測定 → **約1.65V** になればOK

💡 **電圧フォロワとは？** 入力電圧と同じ電圧を、低インピーダンス（電流を取っても電圧が下がりにくい）で出力する回路です。

### Step 5: 受信アンプ（2ch目）の配線

**非反転増幅回路:**

```
              ┌────[47pF]────┐
              │              │
信号入力 ─[+IN B]            │
              │           [10kΩ Rf]
           [MCP6022 B]       │
              │              │
[-IN B]───┬───┴──────────────┴── OUT B ──→ ADC入力へ
          │
       [1kΩ Rg]
          │
        Vmid_out
```

**配線手順:**

1. **Rg（1kΩ）の接続:**
   - 片足: ピン6 (-IN B) と同じ列
   - もう片足: Vmid_out（ピン1）と同じ列

2. **Rf（10kΩ）の接続:**
   - 片足: ピン6 (-IN B) と同じ列
   - もう片足: ピン7 (OUT B) と同じ列

3. **47pF（発振防止）の接続:**
   - Rfと並列に接続（同じ2点を結ぶ）

4. **入力（+IN B）:**
   - ピン5 (+IN B) は後で受信コイルからの信号を接続
   - **今はVmid_outに接続しておく**（動作確認用）

**ゲインの計算:**
```
Gain = 1 + Rf/Rg = 1 + 10kΩ/1kΩ = 11倍
```

---

## 動作確認

### 入力をVmidに接続した状態での確認

電源を入れて、テスターで以下を確認:

| 測定点 | 期待値 | 許容範囲 | チェック |
|--------|--------|----------|----------|
| ピン1 (OUT A) - GND | 1.65V | 1.6〜1.7V | ☐ |
| ピン7 (OUT B) - GND | 1.65V | 1.6〜1.7V | ☐ |

💡 **なぜ両方1.65V？** 入力がVmid（1.65V）なので、増幅しても中心は1.65Vのままです。

### オシロスコープがある場合

1. ピン5 (+IN B) にテスト信号（例: 1kHz正弦波、100mVpp）を入力
2. ピン7 (OUT B) の波形を確認
3. 振幅が約11倍（1.1Vpp）になっていればOK

---

## トラブルシューティング

| 症状 | 原因 | 対策 |
|------|------|------|
| OUT Aが1.65Vにならない | Vmid_rawの問題 | モジュール1を再確認 |
| OUT Bが0Vまたは3.3Vに張り付く | 発振している | 47pFが正しく接続されているか確認 |
| OUT Bが1.65Vにならない | Rf/Rgの接続ミス | 抵抗の接続を再確認 |

---

## 回路図まとめ

```
                          MCP6022
                    ┌───────────────┐
Vmid_raw ──────────→│+IN A    VDD│←── 3.3V
                    │              │    │
                    │-IN A   OUT A│──┬─[0.1µF]── GND
                    │      ↑      │  │
                    │      └──────│──┘ (Vmid_out)
                    │              │
(将来:コイル信号)──→│+IN B   OUT B│───→ ADC入力へ
          ↓         │      ↑      │  │
       Vmid_out     │-IN B        │  │
          ↑         │  ↑ │       │  │
          │         │  │ [10kΩ]──│──┘
       [1kΩ]        │  │    │47pF│
          │         │  └────┴────│
        (Rg)        │            │
                    │  VSS       │
                    │   │        │
                    └───┼────────┘
                        │
                       GND
```

---

## 次のステップ

✅ アンプの動作確認が完了したら、[03_adc.md](03_adc.md) へ進みます。


