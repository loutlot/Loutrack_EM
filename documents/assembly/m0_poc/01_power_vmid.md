# モジュール1: 電源 & Vmid生成

## 概要

このモジュールでは:
1. ブレッドボードの電源レールに3.3Vと5Vを配線
2. Vmid（仮想GND = 1.65V）を生成

## なぜVmidが必要？

単電源（0V〜3.3V）で交流信号を扱うため、**中点電圧（1.65V）**を基準にします。
これにより、正負の振動を持つ信号を0V〜3.3Vの範囲で表現できます。

```
3.3V ─────────────────
       ↑
       │  正の振動
1.65V ─│───────────────  ← Vmid（仮想GND）
       │  負の振動
       ↓
  0V ─────────────────
```

---

## 必要な部品

| 部品 | 秋月コード | 数量 | 用途 |
|------|------------|------|------|
| 抵抗 10kΩ 0.1% | 116877 | 2 | Vmid分圧 |
| セラミックC 0.1µF | 117059 | 2 | デカップリング、平滑 |
| 電解C 100µF | 105002 | 1 | バルクデカップリング（オプション） |

---

## 手順

### Step 1: ブレッドボードの準備

ブレッドボードには通常、上下に**電源レール**（赤い線と青い線）があります。

```
+─────────────────────────────────────────────+
│ ● ● ● ● ● ● ● ● ● ● ● ● ● ● ● ● │ ← 赤レール（+）
│ ● ● ● ● ● ● ● ● ● ● ● ● ● ● ● ● │ ← 青レール（GND）
├─────────────────────────────────────────────┤
│                                             │
│   メイン配線エリア（5穴×N列）               │
│                                             │
├─────────────────────────────────────────────┤
│ ● ● ● ● ● ● ● ● ● ● ● ● ● ● ● ● │ ← 赤レール（+）
│ ● ● ● ● ● ● ● ● ● ● ● ● ● ● ● ● │ ← 青レール（GND）
+─────────────────────────────────────────────+
```

💡 **ヒント:** 上側を3.3V系、下側を5V系として使い分けると整理しやすいです。

### Step 2: XIAO ESP32C3から電源を取り出す

XIAO ESP32C3をブレッドボードに挿し、以下を電源レールに接続:

```
XIAO ESP32C3 ピン配置:
        ┌─────────────────┐
        │  ● USB-C ●     │
        │                 │
   D0 ──┤ ●           ● ├── 5V   → 下側赤レールへ
   D1 ──┤ ●           ● ├── GND  → 青レールへ
   D2 ──┤ ●           ● ├── 3V3  → 上側赤レールへ
   D3 ──┤ ●           ● ├── D10
   D4 ──┤ ●           ● ├── D9
   D5 ──┤ ●           ● ├── D8
   D6 ──┤ ●           ● ├── D7
        └─────────────────┘

左側: D0-D6 (GPIO2,3,4,5,6,7,21)
右側: 5V, GND, 3V3, D10-D7 (GPIO10,9,8,20)
```

| XIAOピン | 接続先 | 備考 |
|----------|--------|------|
| 3V3（3.3V出力） | 上側赤レール | アナログ回路用 |
| 5V（USB電源） | 下側赤レール | DRV8835用 |
| GND | 青レール（両方） | 共通GND |

⚠️ **注意:** 上下の青レール（GND）同士を**ジャンパで接続**してください。

### Step 3: Vmid分圧回路の作成

```
3.3V ──[10kΩ]──┬──[10kΩ]── GND
               │
               └── Vmid_raw（約1.65V）
```

**配線手順:**

1. 3.3Vレールから、10kΩ抵抗の片足を接続
2. その10kΩのもう片足を、空いている列（例: 列10）に挿す
3. 同じ列10に、もう1本の10kΩの片足を挿す
4. その10kΩのもう片足をGNDレールに接続

**確認:** テスターで列10とGND間の電圧を測定 → **約1.65V** になればOK

### Step 4: Vmid平滑コンデンサの追加

```
Vmid_raw ──┬── 0.1µF ── GND
           │
           └── Vmid_raw（安定化）
```

**配線手順:**

1. 列10（Vmid_raw）に0.1µFの片足を挿す
2. もう片足をGNDレールに接続

💡 **なぜ平滑が必要？** 分圧抵抗だけだと、ノイズで電圧が揺れます。コンデンサで高周波ノイズを吸収します。

### Step 5: 3.3V側デカップリングコンデンサ

XIAO ESP32C3の3.3V出力近くに0.1µFを追加:

1. 3.3Vレールに0.1µFの片足を接続
2. もう片足をGNDレールに接続

💡 **目的:** 電源のノイズを低減し、アナログ回路の動作を安定させます。

---

## 動作確認

### チェックリスト

電源を入れて、テスターで以下を確認:

| 測定点 | 期待値 | 許容範囲 | チェック |
|--------|--------|----------|----------|
| 3.3Vレール - GND | 3.3V | 3.2〜3.4V | ☐ |
| 5Vレール - GND | 5.0V | 4.8〜5.2V | ☐ |
| Vmid_raw - GND | 1.65V | 1.6〜1.7V | ☐ |

### トラブルシューティング

| 症状 | 原因 | 対策 |
|------|------|------|
| 3.3Vが出ない | XIAO ESP32C3が起動していない | USBケーブル確認、LEDの点灯確認 |
| Vmidが1.65Vにならない | 抵抗値の間違い | 抵抗を確認（テスターで測定） |
| Vmidが不安定 | 平滑Cがない、または接続不良 | 0.1µFの接続を確認 |

---

## 完成図

```
          3.3V
           │
         [10kΩ]
           │
    ┌──────┼──────┐
    │      │      │
  [0.1µF]  │    Vmid_raw ──→ 次のモジュールへ
    │      │      │
    GND  [10kΩ]   │
           │      │
          GND     │
                  │
                 GND
```

---

## 次のステップ

✅ 電源とVmidの確認が完了したら、[02_rx_amplifier.md](02_rx_amplifier.md) へ進みます。


