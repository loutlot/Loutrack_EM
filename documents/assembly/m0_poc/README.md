# M0 PoC 組み立てガイド

## はじめに

このガイドは、電子回路初心者の方がM0 PoC（1軸ディスクリート）を組み立てられるよう、**モジュール単位**で段階的に説明します。

## 使用部品

| 部品 | 型番 | 入手先 |
|------|------|--------|
| MCU | XIAO ESP32C3 | [AliExpress](https://ja.aliexpress.com/item/1005006114576182.html) |
| 3軸コイル | 3D11-722J | [AliExpress](https://ja.aliexpress.com/item/1005004723068527.html) |
| **3D11-722Jテストボード** | **自作基板** | [KiCad設計ファイル](../../kicad/3D11_test_Board/) |
| モータドライバ | DRV8835モジュール | 秋月電子 ([109848](https://akizukidenshi.com/catalog/g/g109848/)) |
| オペアンプ | MCP6022-I/P | 秋月電子 ([116187](https://akizukidenshi.com/catalog/g/g116187/)) |
| ADC | MCP3008-I/P | 秋月電子 ([109485](https://akizukidenshi.com/catalog/g/g109485/)) |

## 3D11-722Jテストボードについて

3D11-722Jは**SMD部品**のため、ブレッドボード（2.54mmピッチ）で直接使用できません。
そのため、KiCadで設計した**テストボード**を作成し、2.54mmピッチのピンヘッダーに変換します。

### テストボードの入手方法

| バージョン | 説明 | KiCadファイル | 3Dレンダリング |
|------------|------|---------------|----------------|
| **単体版** | 1枚の基板（プロトタイプ用） | [3D11_test_Board](../../kicad/3D11_test_Board/) | [3D11_test_Board.png](../../kicad/3D11_test_Board/3D11_test_Board.png) |
| **パネル版** | 10枚を1パネルに（量産用） | [3D11_production](../../kicad/3D11_production/) | [3d11_testboard_batch.png](../../kicad/3D11_production/3d11_testboard_batch.png) |

💡 **基板発注について:**
- 単体版: プロトタイプや少量製作に適しています
- パネル版: 10枚まとめて発注する場合に使用します。到着後、パネルから個別基板を切り離して使用します
- 基板発注は、KiCadから生成したGerberファイル（`garber.zip`）を使用します

### テストボードのピン配置

```
        ┌─────────────┐
        │  3D11-722J  │
        │  Test Board │
        │             │
  Y- ───┤●            │
  Y+ ───┤●            │
  X- ───┤●            │
  X+ ───┤●            │
        │             │
        │    [UP]     │
        │             │
  X+ ───┤●            │
  X- ───┤●            │
  Z+ ───┤●            │
  Z- ───┤●            │
        └─────────────┘

上部: Y-, Y+, X-, X+  (Y軸とX軸)
下部: X+, X-, Z+, Z-  (X軸とZ軸)
```

💡 **注意:** 上部と下部の両方にX軸端子があります。どちらを使ってもOKです。

### テストボードの組み立て

**必要な部品:**
- 3D11-722Jコイル × 1個（1枚の基板あたり）
- ピンヘッダー 1×4（2.54mmピッチ）× 2本（上部・下部用）

**組み立て手順:**

1. **パネル版の場合:** パネルから個別基板を切り離す（ニッパーやカッターで切り離し）
2. **3D11-722Jを基板に実装**
   - 基板の中央に3D11-722Jを配置
   - 向きを確認（基板の"UP"マークに合わせる）
   - SMDはんだ付けを実施
3. **ピンヘッダーを基板に挿入**
   - 上部: 1×4ピンヘッダー（Y-, Y+, X-, X+）
   - 下部: 1×4ピンヘッダー（X+, X-, Z+, Z-）
   - 2.54mmピッチでブレッドボードに挿入可能
4. **動作確認**
   - テスターで各ピン間の導通を確認
   - ショートがないことを確認

詳細は [04_tx_driver.md](04_tx_driver.md) と [05_integration.md](05_integration.md) を参照。

## 組み立て順序（推奨）

各モジュールを**順番に組み立て、動作確認してから次へ進む**ことで、問題が発生しても原因を特定しやすくなります。

```
[0] 3D11-722Jテストボード組み立て（事前準備）
      ↓
[1] 電源 & Vmid
      ↓ 動作確認
[2] 受信アンプ
      ↓ 動作確認
[3] ADC (MCP3008)
      ↓ 動作確認
[4] 送信回路 (DRV8835)
      ↓ 動作確認
[5] 全体結合 & 調整
```

## ドキュメント一覧

| ファイル | 内容 |
|----------|------|
| [01_power_vmid.md](01_power_vmid.md) | 電源配線とVmid（仮想GND）生成 |
| [02_rx_amplifier.md](02_rx_amplifier.md) | 受信アンプ（MCP6022） |
| [03_adc.md](03_adc.md) | ADC（MCP3008）の接続 |
| [04_tx_driver.md](04_tx_driver.md) | 送信ドライバ（DRV8835） |
| [05_integration.md](05_integration.md) | 全体結合と動作確認 |
| [troubleshooting.md](troubleshooting.md) | よくある問題と対策 |

## XIAO ESP32C3 ピンアウト

```
        ┌─────────────────┐
        │   XIAO ESP32C3  │
        │                 │
   D0 ──┤ GPIO2    5V    ├── 5V出力
   D1 ──┤ GPIO3    GND   ├── GND
   D2 ──┤ GPIO4    3V3   ├── 3.3V出力
   D3 ──┤ GPIO5    GPIO21├── D6
   D4 ──┤ GPIO6    GPIO20├── D7
   D5 ──┤ GPIO7    GPIO10├── D10 (MOSI)
        │          GPIO9 ├── D9  (MISO)
        │          GPIO8 ├── D8  (SCK)
        └─────────────────┘
```

## M0での GPIO割り当て

| 機能 | ピン | GPIO | 備考 |
|------|------|------|------|
| PWM_X | D0 | GPIO2 | 送信PWM |
| PWM_X_INV | D1 | GPIO3 | 反転PWM（またはGND固定） |
| SPI_SCK | D8 | GPIO8 | MCP3008 CLK |
| SPI_MISO | D9 | GPIO9 | MCP3008 DOUT |
| SPI_MOSI | D10 | GPIO10 | MCP3008 DIN |
| SPI_CS | D7 | GPIO20 | MCP3008 CS |

## 必要な工具

| 工具 | 用途 | 必須度 |
|------|------|--------|
| テスター（マルチメータ） | 電圧確認、導通チェック | ★★★ 必須 |
| ブレッドボード | 部品配置 | ★★★ 必須 |
| ジャンパワイヤ | 配線 | ★★★ 必須 |
| はんだごて | テストボード組み立て | ★★★ 必須 |
| はんだ | SMD部品実装 | ★★★ 必須 |
| ニッパー | 部品のリード線カット | ★★☆ |
| ラジオペンチ | 部品の取り扱い | ★★☆ |
| ピンセット | 小さい部品の取り扱い | ★☆☆ |
| オシロスコープ | 波形確認（なくてもOK） | ★☆☆ |

## 安全上の注意

⚠️ **電源投入前に必ず確認:**
- 電源（3.3V, 5V）とGNDがショートしていないこと
- ICの向きが正しいこと
- 電解コンデンサの極性が正しいこと
- テストボードのピン配置が正しいこと

⚠️ **作業中の注意:**
- 静電気に注意（ICを触る前に金属に触れる）
- 電源を入れたままの配線変更は避ける
- 異常な発熱・異臭があれば即座に電源を切る
- はんだ作業時は換気を十分に

## 記号の説明

このガイドで使用する記号:

| 記号 | 意味 |
|------|------|
| ✅ | 完了した手順 |
| ⚠️ | 注意事項 |
| 💡 | ヒント・コツ |
| 🔧 | 調整が必要な箇所 |
| ❌ | やってはいけないこと |
